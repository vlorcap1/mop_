<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Observatorio Regional del Maule</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/MarkerCluster.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/MarkerCluster.Default.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/leaflet.markercluster.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#070b14;--bg2:#0d1321;--card:#121a2e;--card2:#182035;--border:#1e2d4a;--t1:#e4e9f2;--t2:#8b9bc0;--t3:#536080;--blue:#4d8eff;--cyan:#22d3ee;--green:#34d399;--amber:#fbbf24;--rose:#fb7185;--violet:#a78bfa;--r:10px;--grad1:linear-gradient(135deg,#4d8eff,#22d3ee);--grad2:linear-gradient(135deg,#34d399,#10b981);--grad3:linear-gradient(135deg,#fbbf24,#f59e0b);--grad4:linear-gradient(135deg,#a78bfa,#8b5cf6)}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--t1);min-height:100vh;overflow-x:hidden}

/* HEADER */
.hdr{background:linear-gradient(180deg,rgba(77,142,255,.06),transparent);border-bottom:1px solid var(--border);padding:.85rem 2rem;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;backdrop-filter:blur(12px)}
.hdr-l{display:flex;align-items:center;gap:1rem}
.logo{width:40px;height:40px;background:var(--grad1);border-radius:10px;display:grid;place-items:center;font-weight:700;font-size:.9rem;color:#fff;box-shadow:0 0 24px rgba(77,142,255,.25)}
.hdr h1{font-family:'Instrument Serif',serif;font-size:1.3rem;background:var(--grad1);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hdr p{font-size:.66rem;color:var(--t3)}
.hdr-r{display:flex;align-items:center;gap:.5rem}
.status{display:flex;align-items:center;gap:.4rem;font-size:.68rem;color:var(--t3);background:var(--card);padding:.38rem .6rem;border-radius:7px;border:1px solid var(--border)}
.dot{width:6px;height:6px;border-radius:50%;background:var(--green);animation:pls 2s infinite}
.dot.err{background:var(--rose);animation:none}
@keyframes pls{0%,100%{opacity:1}50%{opacity:.3}}

/* MAIN TABS */
.main-tabs{display:flex;gap:2px;background:var(--bg2);padding:4px 2rem;border-bottom:1px solid var(--border);position:sticky;top:55px;z-index:99;overflow-x:auto}
.mtab{padding:.55rem 1.1rem;font-size:.76rem;font-weight:500;border:none;background:none;color:var(--t3);cursor:pointer;font-family:inherit;transition:all .2s;white-space:nowrap;border-radius:8px 8px 0 0;position:relative}
.mtab:hover{color:var(--t1);background:rgba(77,142,255,.05)}
.mtab.act{color:#fff;background:rgba(77,142,255,.12)}
.mtab.act::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;background:var(--grad1)}
.tbdg{font-size:.52rem;padding:1px 5px;border-radius:3px;font-weight:600}
.tbdg.lv{background:rgba(52,211,153,.15);color:var(--green)}
.tbdg.ex{background:rgba(77,142,255,.15);color:var(--blue)}

/* TAB CONTENT */
.tc{display:none}.tc.active{display:block}
.ifw{width:100%;height:calc(100vh - 110px);background:var(--bg2);position:relative}
.ifw iframe{width:100%;height:100%;border:none;background:#fff}
.ifld{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:.8rem;color:var(--t2);font-size:.82rem;background:var(--bg2);z-index:2;transition:opacity .3s}
.ifld.hid{opacity:0;pointer-events:none}
.sp{width:30px;height:30px;border:3px solid var(--border);border-top-color:var(--blue);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* MAIN */
.main{max-width:1400px;margin:0 auto;padding:1.4rem 2rem 3rem}
.slbl{font-size:.66rem;text-transform:uppercase;letter-spacing:2px;color:var(--t3);margin-bottom:.75rem;display:flex;align-items:center;gap:.5rem}
.slbl::after{content:'';flex:1;height:1px;background:var(--border)}
.kpis{display:grid;grid-template-columns:repeat(5,1fr);gap:.8rem;margin-bottom:1.4rem}
.kpi{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:1rem 1.15rem;position:relative;overflow:hidden;transition:all .25s}
.kpi:hover{border-color:rgba(77,142,255,.3);transform:translateY(-2px);box-shadow:0 8px 32px rgba(0,0,0,.35)}
.kpi::before{content:'';position:absolute;top:0;left:0;right:0;height:3px}
.kpi:nth-child(1)::before{background:var(--grad1)}.kpi:nth-child(2)::before{background:var(--grad2)}.kpi:nth-child(3)::before{background:var(--grad3)}.kpi:nth-child(4)::before{background:var(--grad4)}.kpi:nth-child(5)::before{background:linear-gradient(135deg,#22d3ee,#06b6d4)}
.kl{font-size:.66rem;color:var(--t3);text-transform:uppercase;letter-spacing:.7px;margin-bottom:.3rem}
.kv{font-family:'Instrument Serif',serif;font-size:1.65rem;letter-spacing:-1px;line-height:1.1}
.kpi:nth-child(1) .kv{color:var(--blue)}.kpi:nth-child(2) .kv{color:var(--green)}.kpi:nth-child(3) .kv{color:var(--amber)}.kpi:nth-child(4) .kv{color:var(--violet)}.kpi:nth-child(5) .kv{color:var(--cyan)}
.kc{font-size:.68rem;margin-top:.2rem}.kc .pos{color:var(--green)}.kc .neg{color:var(--rose)}
.ks{font-size:.56rem;color:var(--t3);margin-top:.3rem;opacity:.6}
.kld{background:linear-gradient(90deg,var(--card),var(--card2),var(--card));background-size:400px;animation:shm 1.4s infinite;height:1.65rem;width:75%;border-radius:4px;margin:3px 0}
@keyframes shm{0%{background-position:-200px 0}100%{background-position:200px 0}}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:.8rem;margin-bottom:.8rem}
.g23{display:grid;grid-template-columns:2fr 1fr;gap:.8rem;margin-bottom:.8rem}
.pnl{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:1.15rem 1.2rem;transition:border-color .3s}
.pnl:hover{border-color:rgba(77,142,255,.15)}
.ph{display:flex;align-items:center;justify-content:space-between;margin-bottom:.8rem}
.pt{font-size:.82rem;font-weight:700}
.bdg{font-size:.56rem;padding:.18rem .42rem;border-radius:4px;font-weight:600}
.ba{background:rgba(77,142,255,.12);color:var(--blue)}.bi{background:rgba(52,211,153,.12);color:var(--green)}.bb{background:rgba(167,139,250,.12);color:var(--violet)}.bl{background:rgba(251,191,36,.12);color:var(--amber)}

#dgaMap{height:400px;width:100%;border-radius:10px;z-index:1}
.leaflet-popup-content-wrapper{background:var(--card)!important;color:var(--t1)!important;border:1px solid var(--border)!important;border-radius:10px!important;box-shadow:0 8px 32px rgba(0,0,0,.5)!important}
.leaflet-popup-tip{background:var(--card)!important}
.leaflet-popup-content{font-family:'DM Sans',sans-serif!important;font-size:.75rem!important;line-height:1.5!important}
.leaflet-popup-content b{color:var(--blue)}
.leaflet-popup-content .pop-tipo{display:inline-block;font-size:.6rem;padding:1px 6px;border-radius:3px;font-weight:600;margin-top:3px}
.map-legend{position:absolute;bottom:24px;right:12px;background:var(--card);border:1px solid var(--border);border-radius:8px;padding:.55rem .7rem;z-index:1000;font-size:.65rem;color:var(--t2);line-height:1.6}
.map-legend i{display:inline-block;width:10px;height:10px;border-radius:50%;margin-right:5px;vertical-align:middle}
.map-filters{display:flex;gap:.3rem;flex-wrap:wrap;margin-bottom:.6rem}
.map-filters button{padding:.25rem .55rem;font-size:.64rem;border-radius:5px;border:1px solid var(--border);background:var(--bg2);color:var(--t2);cursor:pointer;font-family:inherit;transition:all .2s}
.map-filters button.mf-act{border-color:var(--blue);background:rgba(77,142,255,.15);color:var(--blue)}
.map-filters button:hover{border-color:var(--blue)}
.leaflet-container{background:var(--bg2)!important}
.marker-cluster-small,.marker-cluster-medium,.marker-cluster-large{background:rgba(77,142,255,.25)!important}
.marker-cluster-small div,.marker-cluster-medium div,.marker-cluster-large div{background:rgba(77,142,255,.7)!important;color:#fff!important;font-family:'DM Sans',sans-serif!important;font-weight:600!important}
/* Etiquetas de comunas */
.comuna-label{background:rgba(18,26,46,.9)!important;border:1px solid rgba(77,142,255,.4)!important;border-radius:4px;padding:3px 7px;font-size:.65rem!important;font-weight:600!important;color:var(--blue)!important;box-shadow:0 2px 8px rgba(0,0,0,.4)!important}
/* Control de capas */
.leaflet-control-layers{background:var(--card)!important;border:1px solid var(--border)!important;border-radius:8px!important}
.leaflet-control-layers-expanded{background:var(--card)!important;color:var(--t1)!important;padding:8px 12px!important}
.leaflet-control-layers label{color:var(--t1)!important;font-size:.72rem!important}
.leaflet-control-layers-separator{border-top:1px solid var(--border)!important}
canvas{display:block;width:100%!important}
.chw{position:relative;height:200px;width:100%}
.chw.tall{height:220px}
.chw.dn{height:240px}
.tbl{width:100%;border-collapse:collapse;font-size:.74rem}
.tbl th{text-align:left;padding:.48rem .55rem;color:var(--t3);font-weight:500;font-size:.64rem;text-transform:uppercase;border-bottom:1px solid var(--border)}
.tbl td{padding:.48rem .55rem;border-bottom:1px solid rgba(30,45,74,.4);color:var(--t2)}
.tbl .v{color:var(--t1);font-weight:600}.tbl .pos{color:var(--green)}.tbl .neg{color:var(--rose)}
.br{display:flex;align-items:center;gap:.6rem;margin-bottom:.45rem}
.brl{min-width:90px;font-size:.71rem;color:var(--t2);text-align:right}
.brt{flex:1;height:20px;background:rgba(77,142,255,.05);border-radius:4px;overflow:hidden}
.brf{height:100%;border-radius:4px;display:flex;align-items:center;padding-left:7px;font-size:.62rem;font-weight:600;color:#fff;transition:width 1.2s ease}
.brf.b1{background:var(--grad1)}.brf.b2{background:var(--grad2)}.brf.b3{background:var(--grad3)}.brf.b4{background:var(--grad4)}
.tabs{display:flex;gap:3px;margin-bottom:.75rem;background:var(--bg2);padding:3px;border-radius:8px;width:fit-content}
.tab{padding:.28rem .55rem;font-size:.66rem;border-radius:6px;cursor:pointer;color:var(--t3);transition:all .2s;border:none;background:none;font-family:inherit}
.tab.act{background:var(--blue);color:#fff}
.cg{display:grid;grid-template-columns:repeat(5,1fr);gap:.32rem}
.ci{background:var(--bg2);border:1px solid var(--border);border-radius:6px;padding:.42rem .5rem;font-size:.64rem;color:var(--t2);text-align:center}.ci:hover{border-color:var(--blue);color:var(--t1)}
.cv{font-weight:700;color:var(--t1);margin-top:2px;font-size:.7rem}
.ms{display:flex;align-items:center;gap:.65rem;padding:.5rem 0;border-bottom:1px solid rgba(30,45,74,.3)}.ms:last-child{border-bottom:none}
.mi{width:32px;height:32px;border-radius:8px;display:grid;place-items:center;font-size:.9rem;flex-shrink:0}
.mn{font-size:.73rem;color:var(--t1)}.mv{font-size:.64rem;color:var(--t3)}
.ftr{text-align:center;padding:1.2rem;color:var(--t3);font-size:.6rem;border-top:1px solid var(--border)}.ftr a{color:var(--blue);text-decoration:none}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}.anim{animation:fadeUp .4s ease forwards;opacity:0}
@media(max-width:1100px){.kpis{grid-template-columns:repeat(3,1fr)}.g2,.g23{grid-template-columns:1fr}.cg{grid-template-columns:repeat(3,1fr)}}
@media(max-width:600px){.kpis{grid-template-columns:1fr}.hdr{flex-direction:column;gap:.6rem;align-items:flex-start}.main{padding:1rem}.cg{grid-template-columns:repeat(2,1fr)}.main-tabs{padding:4px .5rem}}
</style>
</head>
<body>

<header class="hdr">
  <div class="hdr-l"><div class="logo">VII</div><div><h1>Observatorio Regi√≥n del Maule</h1><p>Indicadores econ√≥micos ¬∑ Proyectos regionales ¬∑ Datos en vivo</p></div></div>
  <div class="hdr-r"><span style="font-size:.6rem;color:var(--t3)" id="upd"></span><div class="status"><div class="dot" id="sDot"></div><span id="sTxt">Conectando...</span></div></div>
</header>

<nav class="main-tabs">
  <button class="mtab act" onclick="sw('dga',this)">üíß DGA Maule <span class="tbdg lv">973</span></button>
  <button class="mtab" onclick="sw('mop',this)">üèóÔ∏è MOP Proyectos</button>
</nav>

<!-- ‚ïê‚ïê‚ïê‚ïê DGA ‚ïê‚ïê‚ïê‚ïê -->
<div class="tc active" id="t-dga">
<main class="main">
<div class="slbl">Direcci√≥n General de Aguas ‚Äî Regi√≥n del Maule</div>
<div class="kpis" style="grid-template-columns:repeat(5,1fr)">
  <div class="kpi"><div class="kl">üíß Estaciones DGA</div><div class="kv" style="color:var(--blue)">361</div><div class="kc"><span class="pos">Monitoreo activo</span></div><div class="ks">DGA - MOP</div></div>
  <div class="kpi"><div class="kl">üèõÔ∏è Organizaciones</div><div class="kv" style="color:var(--green)">612</div><div class="kc"><span class="pos">Usuarios de agua</span></div><div class="ks">DGA</div></div>
  <div class="kpi"><div class="kl">üìç Total Puntos</div><div class="kv" style="color:var(--cyan)">973</div><div class="kc"><span class="pos">En el mapa</span></div><div class="ks">DGA</div></div>
  <div class="kpi"><div class="kl">üèòÔ∏è Comunas</div><div class="kv" style="color:var(--amber)">30</div><div class="kc"><span class="pos">4 provincias</span></div><div class="ks">Regi√≥n</div></div>
  <div class="kpi"><div class="kl">üåä Com. Superficiales</div><div class="kv" style="color:var(--violet)">570</div><div class="kc"><span class="pos">91.6% org.</span></div><div class="ks">DGA</div></div>
</div>

<div class="slbl">Mapa Interactivo Unificado ‚Äî Estaciones + Organizaciones</div>
<div class="pnl" style="position:relative;overflow:visible">
  <div class="ph"><span class="pt">973 Puntos de Datos DGA</span><span class="bdg ba">DGA ¬∑ Leaflet</span></div>
  <div class="map-filters" id="mapFilters">
    <button class="mf-act" onclick="filterUnifiedMap('ALL',this)">Todas (973)</button>
    <button onclick="filterUnifiedMap('ESTACIONES',this)">üíß Estaciones (361)</button>
    <button onclick="filterUnifiedMap('ORGANIZACIONES',this)">üèõÔ∏è Organizaciones (612)</button>
    <button onclick="filterUnifiedMap('CALIDAD DE AGUA',this)">üî¨ Calidad Agua</button>
    <button onclick="filterUnifiedMap('FLUVIOMETRICA',this)">üåä Fluviom√©trica</button>
    <button onclick="filterUnifiedMap('METEOROLOGICA',this)">üå§Ô∏è Meteorol√≥gica</button>
    <button onclick="filterUnifiedMap('Comunidad de Aguas Superficiales',this)">üåä Com. Superficiales</button>
    <button onclick="filterUnifiedMap('Asociaci√≥n de Canalistas',this)">üöú Asoc. Canalistas</button>
    <button onclick="filterUnifiedMap('Junta de Vigilancia',this)">‚öñÔ∏è Juntas Vigilancia</button>
  </div>
  <div id="dgaMap"></div>
  <div class="map-legend">
    <strong>Estaciones:</strong><br>
    <div><i style="background:#4d8eff"></i>Calidad de Agua</div>
    <div><i style="background:#34d399"></i>Fluviom√©trica</div>
    <div><i style="background:#fbbf24"></i>Meteorol√≥gica</div>
    <div><i style="background:#a78bfa"></i>Control de Nivel</div>
    <div><i style="background:#22d3ee"></i>Lagos y Embalses</div>
    <br><strong>Organizaciones:</strong><br>
    <div><i style="background:#4d8eff"></i>Com. Superficiales</div>
    <div><i style="background:#34d399"></i>Asoc. Canalistas</div>
    <div><i style="background:#a78bfa"></i>Juntas Vigilancia</div>
  </div>
</div>

<div class="slbl">An√°lisis de Estaciones DGA</div>
<div class="g2">
  <div class="pnl"><div class="ph"><span class="pt">Estaciones por Tipo</span><span class="bdg ba">DGA</span></div>
    <div class="br"><span class="brl">Calidad De Agua</span><div class="brt"><div class="brf b1" style="width:100%">199</div></div></div>
    <div class="br"><span class="brl">Fluviometrica</span><div class="brt"><div class="brf b2" style="width:42%">83</div></div></div>
    <div class="br"><span class="brl">Meteorologica</span><div class="brt"><div class="brf b3" style="width:25%">50</div></div></div>
    <div class="br"><span class="brl">Control De Nivel</span><div class="brt"><div class="brf b4" style="width:9%">18</div></div></div>
    <div class="br"><span class="brl">Lagos Y Embalses</span><div class="brt"><div class="brf b1" style="width:4%">7</div></div></div>
    <div class="br"><span class="brl">Ruta De Nieve</span><div class="brt"><div class="brf b2" style="width:2%">4</div></div></div>
  </div>
  <div class="pnl"><div class="ph"><span class="pt">Estaciones por Cuenca</span><span class="bdg bi">DGA</span></div>
    <div class="br"><span class="brl" style="min-width:140px">Rio Maule</span><div class="brt"><div class="brf b1" style="width:100%">244</div></div></div>
    <div class="br"><span class="brl" style="min-width:140px">Rio Mataquito</span><div class="brt"><div class="brf b2" style="width:34%">82</div></div></div>
    <div class="br"><span class="brl" style="min-width:140px">Costeras</span><div class="brt"><div class="brf b3" style="width:6%">15</div></div></div>
    <div class="br"><span class="brl" style="min-width:140px">Mataquito-Maule</span><div class="brt"><div class="brf b4" style="width:4%">10</div></div></div>
    <div class="br"><span class="brl" style="min-width:140px">Maule-Limite VIII</span><div class="brt"><div class="brf b1" style="width:4%">10</div></div></div>
  </div>
</div>

<div class="g2">
  <div class="pnl"><div class="ph"><span class="pt">Distribuci√≥n por Provincia (Estaciones)</span><span class="bdg bb">DGA</span></div><div class="chw dn"><canvas id="cDgaProv"></canvas></div></div>
  <div class="pnl"><div class="ph"><span class="pt">Top Comunas con m√°s Estaciones</span><span class="bdg bi">DGA</span></div><div class="cg" style="grid-template-columns:repeat(4,1fr)">
    <div class="ci"><div>San Clemente</div><div class="cv">59</div></div>
    <div class="ci"><div>Linares</div><div class="cv">28</div></div>
    <div class="ci"><div>Curic√≥</div><div class="cv">26</div></div>
    <div class="ci"><div>Parral</div><div class="cv">19</div></div>
    <div class="ci"><div>Vichuqu√©n</div><div class="cv">16</div></div>
    <div class="ci"><div>Cauquenes</div><div class="cv">15</div></div>
    <div class="ci"><div>Teno</div><div class="cv">14</div></div>
    <div class="ci"><div>Colb√∫n</div><div class="cv">14</div></div>
  </div></div>
</div>

<div class="slbl">An√°lisis de Organizaciones de Usuarios</div>
<div class="g2">
  <div class="pnl"><div class="ph"><span class="pt">Organizaciones por Provincia</span><span class="bdg bb">DGA</span></div>
    <div class="br"><span class="brl" style="min-width:140px">Linares</span><div class="brt"><div class="brf b1" style="width:100%">222</div></div></div>
    <div class="br"><span class="brl" style="min-width:140px">Talca</span><div class="brt"><div class="brf b2" style="width:93%">207</div></div></div>
    <div class="br"><span class="brl" style="min-width:140px">Curic√≥</span><div class="brt"><div class="brf b3" style="width:73%">162</div></div></div>
    <div class="br"><span class="brl" style="min-width:140px">Cauquenes</span><div class="brt"><div class="brf b4" style="width:5%">10</div></div></div>
  </div>
  <div class="pnl"><div class="ph"><span class="pt">Organizaciones por Tipo</span><span class="bdg bi">DGA</span></div>
    <div class="br"><span class="brl" style="min-width:180px">Com. Superficiales</span><div class="brt"><div class="brf b1" style="width:100%">570</div></div></div>
    <div class="br"><span class="brl" style="min-width:180px">Asoc. Canalistas</span><div class="brt"><div class="brf b2" style="width:6%">34</div></div></div>
    <div class="br"><span class="brl" style="min-width:180px">Juntas Vigilancia</span><div class="brt"><div class="brf b3" style="width:1.4%">8</div></div></div>
  </div>
</div>

<div class="slbl">Listado de Estaciones (100 de 361)</div>
<div class="pnl" style="overflow-x:auto">
  <div style="margin-bottom:.6rem;display:flex;gap:.4rem;align-items:center">
    <input type="text" id="dgaSearch" placeholder="Buscar estaci√≥n, comuna, cuenca..." oninput="filterDGA()" style="background:var(--bg2);border:1px solid var(--border);color:var(--t1);padding:.4rem .6rem;border-radius:6px;font-size:.72rem;font-family:inherit;flex:1">
    <span style="font-size:.65rem;color:var(--t3)" id="dgaCount">Mostrando 100 de 361</span>
  </div>
  <table class="tbl" id="dgaTable">
    <thead><tr><th>C√≥digo</th><th>Estaci√≥n</th><th>Provincia</th><th>Comuna</th><th>Tipo</th><th>Cuenca</th><th>Alt.</th></tr></thead>
    <tbody><tr><td class="v">07000006</td><td>LAGO VICHUQUEN ESTERO LLICO</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>-</td></tr>
<tr><td class="v">07000007</td><td>LAGO VICHUQUEN SECTOR BAHIA VICHUQUEN</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>-</td></tr>
<tr><td class="v">07000008</td><td>LAGO VICHUQUEN EN ESTERO VICHUQUEN</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>-</td></tr>
<tr><td class="v">07000009</td><td>LAGO VICHUQUEN EN SECTOR CENTRO</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>-</td></tr>
<tr><td class="v">07000010</td><td>LAGUNA TORCA SECTOR CENTRO</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>-</td></tr>
<tr><td class="v">07000011</td><td>LAGO VICHUQUEN Z MAX</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>-</td></tr>
<tr><td class="v">07000012</td><td>POZO SECTOR VICHUQUEN</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>19</td></tr>
<tr><td class="v">07000013</td><td>LAGO TILICURA - Z MAX</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>-</td></tr>
<tr><td class="v">07000014</td><td>LAGO TILICURA - PUNTO LAGUNA 1</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>-</td></tr>
<tr><td class="v">07000015</td><td>LAGO TILICURA - PUNTO LAGUNA 2</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>-</td></tr>
<tr><td class="v">07000016</td><td>APR DUAO-LIPIMAVIDA</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>-</td></tr>
<tr><td class="v">07000017</td><td>APR LLICO</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>-</td></tr>
<tr><td class="v">07000018</td><td>APR VICHUQUEN</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>-</td></tr>
<tr><td class="v">07000019</td><td>POZO VICHUQUEN</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg bl">CONTROL DE NIVEL</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>195</td></tr>
<tr><td class="v">07000020</td><td>ESTERO LLICO EN EL PUENTE</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg bi">FLUVIOMETRICA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>7</td></tr>
<tr><td class="v">07100006</td><td>PASO VERGARA</td><td>CURICO</td><td>ROMERAL</td><td><span class="bdg bl">RUTA DE NIEVE</span></td><td>RIO MATAQUITO</td><td>2602</td></tr>
<tr><td class="v">07100007</td><td>RIO MALO ANTES JUNTA RIO TENO</td><td>CURICO</td><td>ROMERAL</td><td><span class="bdg bi">FLUVIOMETRICA</span></td><td>RIO MATAQUITO</td><td>1568</td></tr>
<tr><td class="v">07100008</td><td>EMBALSE EL PLANCHON (LM)</td><td>CURICO</td><td>ROMERAL</td><td><span class="bdg bb">METEOROLOGICA</span></td><td>RIO MATAQUITO</td><td>2500</td></tr>
<tr><td class="v">07101001</td><td>RIO TENO ANTES RIO INFIERNILLO (CA)</td><td>CURICO</td><td>ROMERAL</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>1100</td></tr>
<tr><td class="v">07102001</td><td>RIO TENO EN LOS QUE√ëES</td><td>CURICO</td><td>TENO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>900</td></tr>
<tr><td class="v">07102005</td><td>RIO TENO BAJO QUEBRADA INFIERNILLO</td><td>CURICO</td><td>ROMERAL</td><td><span class="bdg bi">FLUVIOMETRICA</span></td><td>RIO MATAQUITO</td><td>990</td></tr>
<tr><td class="v">07103001</td><td>RIO CLARO EN LOS QUE√ëES</td><td>CURICO</td><td>ROMERAL</td><td><span class="bdg bi">FLUVIOMETRICA</span></td><td>RIO MATAQUITO</td><td>900</td></tr>
<tr><td class="v">07103003</td><td>LOS QUE√ëES</td><td>CURICO</td><td>ROMERAL</td><td><span class="bdg bb">METEOROLOGICA</span></td><td>RIO MATAQUITO</td><td>663</td></tr>
<tr><td class="v">07104002</td><td>RIO TENO DESPUES DE JUNTA CON CLARO</td><td>CURICO</td><td>TENO</td><td><span class="bdg bi">FLUVIOMETRICA</span></td><td>RIO MATAQUITO</td><td>647</td></tr>
<tr><td class="v">07104005</td><td>EL MANZANO</td><td>CURICO</td><td>ROMERAL</td><td><span class="bdg bb">METEOROLOGICA</span></td><td>RIO MATAQUITO</td><td>574</td></tr>
<tr><td class="v">07105003</td><td>POZO RAUCO</td><td>CURICO</td><td>RAUCO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07105004</td><td>APR COMALLE</td><td>CURICO</td><td>TENO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07105005</td><td>APR HACIENDA TENO-RINCON DE MORALES</td><td>CURICO</td><td>TENO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07105006</td><td>APR LA PALMILLA-CURICO</td><td>CURICO</td><td>RAUCO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07105007</td><td>APR LAS ARBOLEDAS</td><td>CURICO</td><td>TENO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07106006</td><td>RIO TENO ANTES JUNTA MATAQUITO (CA)</td><td>CURICO</td><td>TENO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07106007</td><td>SANTA SUSANA</td><td>CURICO</td><td>TENO</td><td><span class="bdg bb">METEOROLOGICA</span></td><td>RIO MATAQUITO</td><td>410</td></tr>
<tr><td class="v">07106016</td><td>POZO LA LAGUNA TENO</td><td>CURICO</td><td>TENO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>470</td></tr>
<tr><td class="v">07106017</td><td>APR DOMINGO MANSILLA</td><td>CURICO</td><td>TENO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07106018</td><td>APR EL MOLINO-VENTANA DEL ALTO</td><td>CURICO</td><td>TENO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07106019</td><td>APR LA LAGUNA</td><td>CURICO</td><td>TENO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07106020</td><td>APR LOS NICHES-SANTA ELENA</td><td>CURICO</td><td>CURICO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07106021</td><td>APR PIEDRA BLANCA</td><td>CURICO</td><td>TENO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07106022</td><td>APR QUILVO</td><td>CURICO</td><td>ROMERAL</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07106023</td><td>APR RINCON DE SARMIENTO</td><td>CURICO</td><td>CURICO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07106024</td><td>APR SANTA REBECA-PURISIMA</td><td>CURICO</td><td>TENO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07106025</td><td>APR VENTANA DEL BAJO</td><td>CURICO</td><td>TENO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07106026</td><td>APR VISTA HERMOSA</td><td>CURICO</td><td>CURICO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07106027</td><td>APR LOS GUAICOS (GUAICO-SOCAVON)</td><td>CURICO</td><td>ROMERAL</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07106028</td><td>APR VISTA HERMOSA (VAQUERIA-ALQUIHUE)</td><td>CURICO</td><td>CURICO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07111001</td><td>VOLCAN AZUFRE</td><td>CURICO</td><td>CURICO</td><td><span class="bdg bb">METEOROLOGICA</span></td><td>RIO MATAQUITO</td><td>3154</td></tr>
<tr><td class="v">07112001</td><td>RIO COLORADO EN JUNTA CON PALOS</td><td>CURICO</td><td>CURICO</td><td><span class="bdg bi">FLUVIOMETRICA</span></td><td>RIO MATAQUITO</td><td>600</td></tr>
<tr><td class="v">07115001</td><td>RIO PALOS EN JUNTA CON COLORADO</td><td>CURICO</td><td>CURICO</td><td><span class="bdg bi">FLUVIOMETRICA</span></td><td>RIO MATAQUITO</td><td>600</td></tr>
<tr><td class="v">07116001</td><td>ESTERO UPEO EN UPEO</td><td>CURICO</td><td>CURICO</td><td><span class="bdg bi">FLUVIOMETRICA</span></td><td>RIO MATAQUITO</td><td>450</td></tr>
<tr><td class="v">07116004</td><td>MONTE OSCURO</td><td>CURICO</td><td>CURICO</td><td><span class="bdg bb">METEOROLOGICA</span></td><td>RIO MATAQUITO</td><td>632</td></tr>
<tr><td class="v">07116005</td><td>POTRERO GRANDE</td><td>CURICO</td><td>CURICO</td><td><span class="bdg bb">METEOROLOGICA</span></td><td>RIO MATAQUITO</td><td>445</td></tr>
<tr><td class="v">07116006</td><td>APR POTRERO GRANDE</td><td>CURICO</td><td>CURICO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07117001</td><td>RIO LONTUE EN LONGITUDINAL</td><td>CURICO</td><td>CURICO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07117002</td><td>RIO LONTUE DESP.JUNTA PALOS Y COLORADO</td><td>CURICO</td><td>MOLINA</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07117008</td><td>RIO LONTUE EN PUENTE EL YACAL</td><td>CURICO</td><td>CURICO</td><td><span class="bdg bi">FLUVIOMETRICA</span></td><td>RIO MATAQUITO</td><td>426</td></tr>
<tr><td class="v">07117009</td><td>APR BAJO L.ROMEROS (B.L.ROMEROS-BUENA UNI√ìN-3 ESQ)</td><td>CURICO</td><td>MOLINA</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07117010</td><td>APR CORDILLERILLA</td><td>CURICO</td><td>CURICO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07117011</td><td>APR EL MAITEN-SAN SALVADOR</td><td>CURICO</td><td>CURICO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07117012</td><td>APR LA CUESTA (QUEBRADA DE CORDILLERILLA)</td><td>CURICO</td><td>CURICO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07117013</td><td>APR LOS CASTANOS</td><td>CURICO</td><td>CURICO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07117014</td><td>APR PICHINGAL</td><td>CURICO</td><td>MOLINA</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07117015</td><td>APR PIRIHUIN-LOS CANALES</td><td>CURICO</td><td>MOLINA</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07117016</td><td>APR SAN JORGE DE ROMERAL</td><td>CURICO</td><td>MOLINA</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07118003</td><td>CURICO</td><td>CURICO</td><td>CURICO</td><td><span class="bdg bb">METEOROLOGICA</span></td><td>RIO MATAQUITO</td><td>195</td></tr>
<tr><td class="v">07118005</td><td>APR EL PEUMAL-SAN RAMON</td><td>CURICO</td><td>ROMERAL</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07118006</td><td>APR LA OBRA</td><td>CURICO</td><td>CURICO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07118007</td><td>APR LOS CRISTALES (LONGAVI)</td><td>LINARES</td><td>LONGAVI</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07118008</td><td>ESTERO GUAIQUILLO EN PUENTE COLORADO</td><td>CURICO</td><td>CURICO</td><td><span class="bdg bi">FLUVIOMETRICA</span></td><td>RIO MATAQUITO</td><td>224</td></tr>
<tr><td class="v">07119003</td><td>RIO LONTUE EN SAGRADA FAMILIA (CA)</td><td>CURICO</td><td>CURICO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>145</td></tr>
<tr><td class="v">07119007</td><td>LONTUE</td><td>CURICO</td><td>CURICO</td><td><span class="bdg bb">METEOROLOGICA</span></td><td>RIO MATAQUITO</td><td>199</td></tr>
<tr><td class="v">07119009</td><td>ESTADIO DE MOLINA</td><td>CURICO</td><td>MOLINA</td><td><span class="bdg bl">CONTROL DE NIVEL</span></td><td>RIO MATAQUITO</td><td>279</td></tr>
<tr><td class="v">07119010</td><td>APR CASABLANCA</td><td>CURICO</td><td>MOLINA</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07119011</td><td>APR EL CRUCERO (SANTA ROSA)</td><td>CURICO</td><td>SAGRADA FAMILIA</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07119012</td><td>APR HUALEMU (LO VALDIVIA)</td><td>CURICO</td><td>SAGRADA FAMILIA</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07119013</td><td>APR TUTUQUEN</td><td>CURICO</td><td>CURICO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07119014</td><td>APR TUTUQUEN BAJO</td><td>CURICO</td><td>CURICO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07120002</td><td>LAGUNA DE TORCA</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg bb">METEOROLOGICA</span></td><td>RIO MATAQUITO</td><td>28</td></tr>
<tr><td class="v">07120003</td><td>APR SANTA ANA DE PETEROA</td><td>CURICO</td><td>SAGRADA FAMILIA</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07121003</td><td>VILLA PRAT</td><td>CURICO</td><td>SAGRADA FAMILIA</td><td><span class="bdg bb">METEOROLOGICA</span></td><td>RIO MATAQUITO</td><td>90</td></tr>
<tr><td class="v">07121005</td><td>Estadio de Huaqu√©n</td><td>TALCA</td><td>CUREPTO</td><td><span class="bdg bl">CONTROL DE NIVEL</span></td><td>RIO MATAQUITO</td><td>64</td></tr>
<tr><td class="v">07121006</td><td>RIO MATAQUITO EN PUENTE LA HUERTA</td><td>CURICO</td><td>CURICO</td><td><span class="bdg bi">FLUVIOMETRICA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07121007</td><td>APR HUAQUEN</td><td>CURICO</td><td>SAGRADA FAMILIA</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07121008</td><td>APR LA HUERTA (LA HUERTA DE MATAQUITO)</td><td>CURICO</td><td>HUALAGNE</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07121009</td><td>APR ORILLA DE NAVARRO</td><td>CURICO</td><td>HUALAGNE</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07121010</td><td>APR VILLA PRAT</td><td>CURICO</td><td>SAGRADA FAMILIA</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07121011</td><td>ESTERO CULENAR EN VILLA PRAT</td><td>CURICO</td><td>SAGRADA FAMILIA</td><td><span class="bdg bi">FLUVIOMETRICA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07122002</td><td>APR PERALILLO</td><td>CURICO</td><td>HUALAGNE</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07123001</td><td>RIO MATAQUITO EN LICANTEN</td><td>CURICO</td><td>LICANTEN</td><td><span class="bdg bi">FLUVIOMETRICA</span></td><td>RIO MATAQUITO</td><td>20</td></tr>
<tr><td class="v">07123003</td><td>RIO MATAQUITO EN PUENTE LAUTARO (CA)</td><td>CURICO</td><td>LICANTEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07123008</td><td>RIO MATAQUITO A. ABAJO PLANTA CELULOSA LICANCEL</td><td>CURICO</td><td>LICANTEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07123009</td><td>POZO SECTOR LORA</td><td>CURICO</td><td>LICANTEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>15</td></tr>
<tr><td class="v">07123010</td><td>APR PLACILLA</td><td>CURICO</td><td>LICANTEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07123011</td><td>APR LORA</td><td>CURICO</td><td>LICANTEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07123012</td><td>LICANTEN</td><td>CURICO</td><td>LICANTEN</td><td><span class="bdg bb">METEOROLOGICA</span></td><td>RIO MATAQUITO</td><td>17</td></tr>
<tr><td class="v">07123013</td><td>RIO MATAQUITO EN HUALA√ëE</td><td>CURICO</td><td>HUALAGNE</td><td><span class="bdg bi">FLUVIOMETRICA</span></td><td>RIO MATAQUITO</td><td>30</td></tr>
<tr><td class="v">07124000</td><td>APR EL RODEO</td><td>TALCA</td><td>CUREPTO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07124001</td><td>APR LIEN-PLACILLA DE LIEN</td><td>TALCA</td><td>CUREPTO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>-</td></tr>
<tr><td class="v">07200001</td><td>GUALLECO</td><td>TALCA</td><td>CUREPTO</td><td><span class="bdg bb">METEOROLOGICA</span></td><td>COSTERAS MATAQUITO-MAULE</td><td>100</td></tr>
<tr><td class="v">07200002</td><td>RIO HUENCHULLAMI EN COIPUE</td><td>TALCA</td><td>CUREPTO</td><td><span class="bdg bi">FLUVIOMETRICA</span></td><td>COSTERAS MATAQUITO-MAULE</td><td>-</td></tr>
<tr><td class="v">07200003</td><td>APR BATUCO</td><td>TALCA</td><td>PENCAHUE</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS MATAQUITO-MAULE</td><td>-</td></tr>
</tbody>
  </table>
</div>
</main>
<footer class="ftr">Fuente: Informe Nacional DGA ‚Äî MOP ¬∑ Direcci√≥n General de Aguas ¬∑ Regi√≥n del Maule (361 estaciones)</footer>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê MOP PROYECTOS ‚ïê‚ïê‚ïê‚ïê -->
<div class="tc" id="t-mop">
  <div class="ifw">
    <div class="ifld" id="ld-mop"><div class="sp"></div><div>Cargando MOP Proyectos...</div></div>
  </div>
</div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TABS + LAZY IFRAME ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const IURLS = {
  mop: 'https://vlorcap1.github.io/mop_prueba_2/',
  powerbi: 'https://app.powerbi.com/view?r=eyJrIjoiOGNhOGEwZDQtMjQ1NC00YmY3LWI3MzYtYWYyNzJlNTMzMjljIiwidCI6ImU3ZDU1MzE2LTQ5M2EtNGRiMi05NzRjLWUwODllZjZjMGZkZSJ9&pageName=d2cff37972c7f96b2245'
};
const iLoaded = {};

function sw(id, btn) {
  document.querySelectorAll('.mtab').forEach(t => t.classList.remove('act'));
  document.querySelectorAll('.tc').forEach(t => t.classList.remove('active'));
  btn.classList.add('act');
  document.getElementById('t-' + id).classList.add('active');
  if (id === 'dga') { setTimeout(function(){ initDGAMap(); if(dgaMap) dgaMap.invalidateSize(); }, 100); }
  if (IURLS[id] && !iLoaded[id]) {
    iLoaded[id] = true;
    const wrap = document.querySelector('#t-' + id + ' .ifw');
    const ld = document.getElementById('ld-' + id);
    const ifr = document.createElement('iframe');
    ifr.src = IURLS[id];
    ifr.onload = function () {
      if (ld) ld.classList.add('hid');
    };
    ifr.onerror = function () {
      if (ld) ld.innerHTML = '<div style="color:var(--rose)">‚ö†Ô∏è Error al cargar</div><a href="' + IURLS[id] + '" target="_blank" style="color:var(--blue);font-size:.8rem;margin-top:.5rem">Abrir en nueva pesta√±a ‚Üí</a>';
    };
    wrap.appendChild(ifr);
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CHART.JS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
Chart.defaults.color = '#536080';
Chart.defaults.borderColor = 'rgba(30,45,74,.35)';
Chart.defaults.font.family = "'DM Sans',sans-serif";
Chart.defaults.font.size = 11;
const CH = {};

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê API FETCH WITH CORS PROXIES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const API = 'https://mindicador.cl/api';
const PX = [
  function(u) { return u; },
  function(u) { return 'https://api.allorigins.win/raw?url=' + encodeURIComponent(u); },
  function(u) { return 'https://corsproxy.io/?' + encodeURIComponent(u); },
  function(u) { return 'https://api.codetabs.com/v1/proxy?quest=' + encodeURIComponent(u); }
];

async function apif(url) {
  for (var i = 0; i < PX.length; i++) {
    try {
      var r = await fetch(PX[i](url), { signal: AbortSignal.timeout(12000) });
      if (!r.ok) continue;
      var txt = await r.text();
      if (!txt || txt.length < 20) continue;
      return JSON.parse(txt);
    } catch (e) { continue; }
  }
  return null;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HELPERS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
var fC = function(v) { return '$' + Math.round(v).toLocaleString('es-CL'); };
var fD = function(v, d) { return v.toFixed(d || 1).replace('.', ','); };
var fP = function(v) { return fD(v) + '%'; };
var fMo = function(d) { return new Date(d).toLocaleDateString('es-CL', { month: 'short', year: '2-digit' }); };

function proc(data, n) {
  if (!data || !data.serie || !data.serie.length) return null;
  var items = data.serie.slice(0, n || 30).reverse();
  return { labels: items.map(function(i) { return fMo(i.fecha); }), data: items.map(function(i) { return i.valor; }) };
}

function mkLine(id, labels, data, o) {
  var el = document.getElementById(id);
  if (!el) return;
  if (CH[id]) CH[id].destroy();
  var g = el.getContext('2d').createLinearGradient(0, 0, 0, 195);
  g.addColorStop(0, (o.color || '#4d8eff') + '28');
  g.addColorStop(1, (o.color || '#4d8eff') + '02');
  CH[id] = new Chart(el, {
    type: 'line',
    data: { labels: labels, datasets: [{ data: data, borderColor: o.color, backgroundColor: g, borderWidth: 2, fill: true, tension: .35, pointRadius: 0, pointHoverRadius: 4, pointHoverBackgroundColor: o.color }] },
    options: {
      responsive: true, maintainAspectRatio: false, interaction: { intersect: false, mode: 'index' },
      plugins: { legend: { display: false }, tooltip: { backgroundColor: '#121a2eee', borderColor: o.color, borderWidth: 1, padding: 8, cornerRadius: 8,
        callbacks: { label: function(c) { return o.cur ? (o.pre || '$') + c.parsed.y.toLocaleString('es-CL', { maximumFractionDigits: o.dec || 0 }) : c.parsed.y.toFixed(o.dec || 1).replace('.', ',') + (o.suf || ''); } }
      }},
      scales: { x: { grid: { display: false }, ticks: { maxTicksLimit: 7, maxRotation: 0 } }, y: { grid: { color: 'rgba(30,45,74,.2)' } } }
    }
  });
}

function mkBar(id, labels, data) {
  var el = document.getElementById(id); if (!el) return;
  if (CH[id]) CH[id].destroy();
  CH[id] = new Chart(el, {
    type: 'bar',
    data: { labels: labels, datasets: [{ data: data, backgroundColor: data.map(function(v) { return v >= 0 ? '#34d399' : '#fb7185'; }), borderRadius: 4, borderSkipped: false, barPercentage: .6 }] },
    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { backgroundColor: '#121a2eee', padding: 8, cornerRadius: 8, callbacks: { label: function(c) { return c.parsed.y.toFixed(1).replace('.', ',') + '%'; } } } }, scales: { x: { grid: { display: false } }, y: { grid: { color: 'rgba(30,45,74,.2)' } } } }
  });
}

function mkDo(id, labels, data, colors) {
  var el = document.getElementById(id); if (!el) return;
  if (CH[id]) CH[id].destroy();
  CH[id] = new Chart(el, {
    type: 'doughnut',
    data: { labels: labels, datasets: [{ data: data, backgroundColor: colors, borderColor: '#121a2e', borderWidth: 2, hoverOffset: 6 }] },
    options: { responsive: true, maintainAspectRatio: false, cutout: '60%', plugins: { legend: { position: 'right', labels: { boxWidth: 10, padding: 7, font: { size: 10.5 }, color: '#8b9bc0' } } } }
  });
}

function fall(id, name, key) {
  var el = document.getElementById(id); if (!el) return;
  el.style.display = 'none';
  var parent = el.closest('.chw') || el.parentElement;
  var d = document.createElement('div');
  d.style.cssText = 'display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;color:var(--t3);font-size:.78rem;gap:.5rem;text-align:center';
  d.innerHTML = '<div style="font-size:1.2rem;opacity:.4">üìä</div><div>Sin datos: <b>' + name + '</b></div><button onclick="retry(\'' + id + '\',\'' + key + '\')" style="background:var(--blue);color:#fff;border:none;padding:.4rem .7rem;border-radius:6px;cursor:pointer;font-size:.7rem;font-family:inherit">Reintentar</button>';
  parent.appendChild(d);
}

/* chart configs */
var CFG = {
  dolar:    { id: 'cD',   color: '#4d8eff', cur: true, pre: '$', dec: 0, n: 30, name: 'D√≥lar' },
  uf:       { id: 'cU',   color: '#22d3ee', cur: true, pre: '$', dec: 0, n: 30, name: 'UF' },
  ipc:      { id: 'cI',   color: '#fbbf24', cur: false, suf: '%', dec: 1, n: 12, name: 'IPC' },
  imacec:   { id: 'cM',   color: '#a78bfa', cur: false, suf: '', dec: 1, n: 12, name: 'IMACEC' },
  tasa_desempleo: { id: 'cDes', color: '#fb7185', cur: false, suf: '%', dec: 1, n: 20, name: 'Desempleo' },
  tpm:      { id: 'cTpm', color: '#34d399', cur: false, suf: '%', dec: 2, n: 20, name: 'TPM' },
  bitcoin:  { id: 'cBtc', color: '#fbbf24', cur: true, pre: 'US$', dec: 0, n: 30, name: 'Bitcoin' },
  libra_cobre: { id: 'cCob', color: '#f97316', cur: true, pre: 'US$', dec: 2, n: 30, name: 'Cobre' }
};

async function retry(canvasId, key) {
  var el = document.getElementById(canvasId);
  var parent = el.closest('.chw') || el.parentElement;
  var fb = parent.querySelector('div[style*="flex-direction"]');
  if (fb) fb.remove();
  el.style.display = 'block';
  var d = await apif(API + '/' + key);
  var s = proc(d, CFG[key].n);
  if (s) mkLine(canvasId, s.labels, s.data, CFG[key]);
  else fall(canvasId, CFG[key].name, key);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê COMUNAS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
var COM = {
  talca: [['Talca','245.347'],['Constituci√≥n','52.099'],['Curepto','8.263'],['Empedrado','3.590'],['Maule','16.255'],['Pelarco','7.584'],['Pencahue','7.929'],['R√≠o Claro','12.766'],['San Clemente','43.361'],['San Rafael','8.819']],
  curico: [['Curic√≥','155.990'],['Huala√±√©','8.476'],['Licant√©n','7.312'],['Molina','47.479'],['Rauco','10.248'],['Romeral','14.218'],['Sagrada Familia','17.148'],['Teno','30.452'],['Vichuqu√©n','3.817']],
  linares: [['Linares','98.060'],['Colb√∫n','18.021'],['Longav√≠','28.645'],['Parral','37.822'],['Retiro','16.853'],['San Javier','34.113'],['Villa Alegre','15.487'],['Yerbas Buenas','17.484']],
  cauquenes: [['Cauquenes','38.230'],['Chanco','7.726'],['Pelluhue','7.190']]
};
function prov(btn, p) {
  document.querySelectorAll('.tabs .tab').forEach(function(t) { t.classList.remove('act'); });
  btn.classList.add('act');
  document.getElementById('cGrid').innerHTML = COM[p].map(function(c) { return '<div class="ci"><div>' + c[0] + '</div><div class="cv">' + c[1] + '</div></div>'; }).join('');
}


/* DGA search filter */
function filterDGA() {
  var q = document.getElementById('dgaSearch').value.toLowerCase();
  var rows = document.querySelectorAll('#dgaTable tbody tr');
  var shown = 0;
  rows.forEach(function(r) {
    var txt = r.textContent.toLowerCase();
    var match = !q || txt.indexOf(q) >= 0;
    r.style.display = match ? '' : 'none';
    if (match) shown++;
  });
  document.getElementById('dgaCount').textContent = 'Mostrando ' + shown + ' de 361';
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DGA MAP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
var DGA_STATIONS = [{"lat": -34.82917, "lon": -72.06778, "nom": "LAGO VICHUQUEN ESTERO LLICO", "tipo": "CALIDAD DE AGUA", "com": "VICHUQUEN", "cuenca": "COSTERAS LIMITE SEPTIMA R.-RIO MATA", "cod": "07000006"}];
var DGA_ORGANIZATIONS = [{"lat":-35.44005566932599,"lon":-71.65285658944133,"nom":"ASTUDILLANO                                                                                                                              ","tipo":"Comunidad de Aguas Superficiales","com":"SAN CLEMENTE","provincia":"Talca"}];
console.log('DGA_ORGANIZATIONS cargado:', DGA_ORGANIZATIONS.length);
var dgaMap = null;
var dgaOrgMap = null;
var dgaMarkers = null;
var dgaOrgMarkers = null;
var dgaAllLayers = [];
var dgaOrgAllLayers = [];

var TIPO_COLORS = {
  'CALIDAD DE AGUA': '#4d8eff',
  'FLUVIOMETRICA': '#34d399',
  'METEOROLOGICA': '#fbbf24',
  'CONTROL DE NIVEL': '#a78bfa',
  'LAGOS Y EMBALSES': '#22d3ee',
  'RUTA DE NIEVE': '#818cf8',
  'SEDIMENTOMETRICA': '#f97316',
  'NIEVES Y GLACIARES': '#818cf8'
};

var TIPO_COLORS_ORG = {
  'Comunidad de Aguas Superficiales': '#4d8eff',
  'Asociaci√≥n de Canalistas': '#34d399',
  'Junta de Vigilancia': '#a78bfa'
};

function initDGAMap() {
  if (dgaMap) return;
  dgaMap = L.map('dgaMap', { zoomControl: true }).setView([-35.5, -71.3], 8);
  
  // Capas base
  var darkLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; <a href="https://carto.com/">CARTO</a> &copy; <a href="https://osm.org/">OSM</a>',
    subdomains: 'abcd', maxZoom: 18
  });
  var satelliteLayer = L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
    attribution: '¬© Google', maxZoom: 20
  });
  var hybridLayer = L.tileLayer('https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}', {
    attribution: '¬© Google', maxZoom: 20
  }).addTo(dgaMap);
  
  // Control de capas
  L.control.layers({
    'üõ∞Ô∏è Satelital + Nombres': hybridLayer,
    'üõ∞Ô∏è Satelital': satelliteLayer,
    'üåô Oscuro': darkLayer
  }, null, { position: 'topright' }).addTo(dgaMap);
  
  // Etiquetas de comunas
  var comunas=[
    {n:'Talca',lt:-35.4264,ln:-71.6536},{n:'Constituci√≥n',lt:-35.3327,ln:-72.4143},
    {n:'Curepto',lt:-35.0897,ln:-72.0189},{n:'Empedrado',lt:-35.5789,ln:-72.2644},
    {n:'Maule',lt:-35.5267,ln:-71.6914},{n:'Pelarco',lt:-35.3853,ln:-71.4108},
    {n:'Pencahue',lt:-35.3856,ln:-71.8308},{n:'R√≠o Claro',lt:-35.2869,ln:-71.2694},
    {n:'San Clemente',lt:-35.5378,ln:-71.4958},{n:'San Rafael',lt:-35.3158,ln:-71.5219},
    {n:'Cauquenes',lt:-35.9672,ln:-72.3242},{n:'Chanco',lt:-35.7333,ln:-72.5350},
    {n:'Pelluhue',lt:-35.8125,ln:-72.5739},{n:'Curic√≥',lt:-34.9828,ln:-71.2394},
    {n:'Huala√±√©',lt:-34.9694,ln:-71.8094},{n:'Licant√©n',lt:-34.9864,ln:-72.0244},
    {n:'Molina',lt:-35.1147,ln:-71.2814},{n:'Rauco',lt:-34.9319,ln:-71.3189},
    {n:'Romeral',lt:-34.9608,ln:-71.1336},{n:'Sagrada Familia',lt:-35.0056,ln:-71.3775},
    {n:'Teno',lt:-34.8644,ln:-71.1642},{n:'Vichuqu√©n',lt:-34.8806,ln:-71.9789},
    {n:'Linares',lt:-35.8464,ln:-71.5975},{n:'Colb√∫n',lt:-35.6939,ln:-71.4039},
    {n:'Longav√≠',lt:-35.9653,ln:-71.6811},{n:'Parral',lt:-36.1428,ln:-71.8258},
    {n:'Retiro',lt:-36.0497,ln:-71.7489},{n:'San Javier',lt:-35.5969,ln:-71.7292},
    {n:'Villa Alegre',lt:-35.6686,ln:-71.7028},{n:'Yerbas Buenas',lt:-35.7403,ln:-71.5653}
  ];
  comunas.forEach(function(c){
    L.marker([c.lt,c.ln],{
      icon:L.divIcon({className:'comuna-label',html:c.n,iconSize:null})
    }).addTo(dgaMap);
  });
  
  dgaMarkers = L.markerClusterGroup({
    maxClusterRadius: 40,
    spiderfyOnMaxZoom: true,
    showCoverageOnHover: false,
    iconCreateFunction: function(cluster) {
      var count = cluster.getChildCount();
      var size = count < 10 ? 'small' : count < 50 ? 'medium' : 'large';
      return L.divIcon({ html: '<div>' + count + '</div>', className: 'marker-cluster marker-cluster-' + size, iconSize: L.point(36, 36) });
    }
  });

  // Agregar ESTACIONES
  DGA_STATIONS.forEach(function(s) {
    var col = TIPO_COLORS[s.tipo] || '#fb7185';
    var icon = L.divIcon({
      className: '',
      html: '<div style="width:10px;height:10px;border-radius:50%;background:' + col + ';border:2px solid #fff;box-shadow:0 0 6px ' + col + '80"></div>',
      iconSize: [10, 10], iconAnchor: [5, 5]
    });
    var popup = '<b>' + s.nom + '</b><br>C√≥digo: ' + s.cod + '<br>Comuna: ' + s.com + '<br>Cuenca: ' + s.cuenca + '<br><span class="pop-tipo" style="background:' + col + '30;color:' + col + '">' + s.tipo + '</span>';
    var marker = L.marker([s.lat, s.lon], { icon: icon }).bindPopup(popup);
    marker._dgaTipo = s.tipo;
    marker._dgaCategoria = 'ESTACIONES';
    dgaAllLayers.push(marker);
    dgaMarkers.addLayer(marker);
  });
  
  // Agregar ORGANIZACIONES
  DGA_ORGANIZATIONS.forEach(function(s) {
    var col = TIPO_COLORS_ORG[s.tipo] || '#fb7185';
    var icon = L.divIcon({
      className: '',
      html: '<div style="width:12px;height:12px;border-radius:50%;background:' + col + ';border:2px solid #fff;box-shadow:0 0 8px ' + col + '90"></div>',
      iconSize: [12, 12],
      iconAnchor: [6, 6]
    });
    var info = '<b>' + s.nom + '</b><br><span style="background:' + col + '30;color:' + col + ';padding:2px 6px;border-radius:3px;font-size:.65rem">' + s.tipo + '</span>';
    if (s.com) info += '<br>Comuna: ' + s.com;
    if (s.provincia) info += '<br>Provincia: ' + s.provincia;
    var marker = L.marker([s.lat, s.lon], { icon: icon }).bindPopup(info);
    marker._dgaTipo = s.tipo;
    marker._dgaCategoria = 'ORGANIZACIONES';
    dgaAllLayers.push(marker);
    dgaMarkers.addLayer(marker);
  });
  
  dgaMap.addLayer(dgaMarkers);
}

function filterUnifiedMap(tipo, btn) {
  document.querySelectorAll('#mapFilters button').forEach(function(b) { b.classList.remove('mf-act'); });
  btn.classList.add('mf-act');
  dgaMarkers.clearLayers();
  dgaAllLayers.forEach(function(m) {
    var mostrar = false;
    if (tipo === 'ALL') {
      mostrar = true;
    } else if (tipo === 'ESTACIONES') {
      mostrar = m._dgaCategoria === 'ESTACIONES';
    } else if (tipo === 'ORGANIZACIONES') {
      mostrar = m._dgaCategoria === 'ORGANIZACIONES';
    } else {
      mostrar = m._dgaTipo === tipo;
    }
    if (mostrar) dgaMarkers.addLayer(m);
  });
}



async function init() {
  prov(document.querySelector('.tabs .tab.act'), 'talca');

  // Static charts
  mkBar('cPib', ['Q1 23','Q2 23','Q3 23','Q4 23','Q1 24','Q2 24','Q3 24','Q4 24'], [-0.5, -0.8, 1.5, 2.1, 4.6, 0.5, 2.0, 14.2]);
  
  // DGA Province chart
  mkDo('cDgaProv', ["Curic√≥", "Linares", "Talca", "Cauquenes"], [100, 112, 130, 19], ['#4d8eff','#34d399','#fbbf24','#a78bfa']);
  mkDo('cSec', ['Agropecuario','Industria','Comercio','Construcci√≥n','EGA','Transporte','Serv. Pers.','Otros'], [22.5,14.2,12.8,8.5,9.1,7.3,8.6,17.0], ['#34d399','#4d8eff','#22d3ee','#fbbf24','#a78bfa','#818cf8','#f97316','#fb7185']);

  var ok = 0;
  // KPI data
  var all = await apif(API);
  if (all) {
    if (all.dolar) { document.getElementById('kD').textContent = fC(all.dolar.valor); document.getElementById('kDc').innerHTML = '<span class="pos">' + new Date(all.dolar.fecha).toLocaleDateString('es-CL') + '</span>'; }
    if (all.uf) { document.getElementById('kU').textContent = fC(all.uf.valor); document.getElementById('kUc').innerHTML = '<span class="pos">' + new Date(all.uf.fecha).toLocaleDateString('es-CL') + '</span>'; }
    if (all.euro) { document.getElementById('kE').textContent = fC(all.euro.valor); document.getElementById('kEc').innerHTML = '<span class="pos">' + new Date(all.euro.fecha).toLocaleDateString('es-CL') + '</span>'; }
    if (all.ipc) { document.getElementById('kI').textContent = fP(all.ipc.valor); document.getElementById('kIc').innerHTML = '<span class="' + (all.ipc.valor >= 0 ? 'pos' : 'neg') + '">' + (all.ipc.valor >= 0 ? '+' : '') + fP(all.ipc.valor) + '</span>'; }
    if (all.imacec) { document.getElementById('kM').textContent = fD(all.imacec.valor, 1); document.getElementById('kMc').innerHTML = '<span class="' + (all.imacec.valor >= 0 ? 'pos' : 'neg') + '">' + (all.imacec.valor >= 0 ? '+' : '') + fD(all.imacec.valor, 1) + '</span>'; }
  }

  // Historical charts
  var keys = Object.keys(CFG);
  var results = await Promise.allSettled(keys.map(function(k) { return apif(API + '/' + k); }));
  results.forEach(function(res, i) {
    var k = keys[i], c = CFG[k];
    if (res.status === 'fulfilled' && res.value) {
      var s = proc(res.value, c.n);
      if (s) { mkLine(c.id, s.labels, s.data, c); ok++; return; }
    }
    fall(c.id, c.name, k);
  });

  // Status
  document.getElementById('sDot').className = ok > 0 ? 'dot' : 'dot err';
  document.getElementById('sTxt').textContent = ok > 0 ? ok + ' indicadores' : 'Sin conexi√≥n';
  if (ok > 0) document.getElementById('upd').textContent = new Date().toLocaleString('es-CL');
}

init();

// Inicializar mapa DGA autom√°ticamente al cargar la p√°gina
window.addEventListener('load', function() {
  setTimeout(function() {
    initDGAMap();
    if(dgaMap) dgaMap.invalidateSize();
  }, 200);
});
</script>
</body>
</html>
